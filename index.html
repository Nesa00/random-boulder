<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Boulder Randomizer</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background: #f8f9fa;
      padding-top: 60px;
    }
    .result-box {
      font-size: 2rem;
      font-weight: bold;
      color: #198754;
    }
    .dropdown-wrapper {
      max-width: 300px;
      margin: 0 auto;
    }
    .history-box {
      max-height: 200px;
      overflow-y: auto;
    }

  </style>
</head>
<body>
  <div class="container text-center">
    <h1 class="mb-4">üßó‚Äç‚ôÇÔ∏è Boulder Randomizer</h1>

    <div class="dropdown-wrapper mb-3 text-start">
      <label for="minGrade" class="form-label">Minimum grade</label>
      <select class="form-select" id="minGrade"></select>
    </div>

    <div class="dropdown-wrapper mb-4 text-start">
      <label for="maxGrade" class="form-label">Maximum grade</label>
      <select class="form-select" id="maxGrade"></select>
    </div>

    <button class="btn btn-success btn-lg" onclick="generate()">üé≤ Pick a problem</button>

    <div id="result" class="mt-4 result-box"></div>
    <div class="mt-4 text-start dropdown-wrapper">
      <h5>History</h5>
      <ul id="history" class="list-group history-box"></ul>
      <div class="mt-2 fw-semibold" id="average"></div>
    </div>
      <button class="btn btn-sm btn-outline-danger mt-2" onclick="clearHistory()">
    Reset history
  </button>

  </div>

  <script>
    const grades = [
      "4C", "5A", "5B", "5C",
      "6A", "6B", "6C",
      "7A", "7B", "7C",
      "8A"
    ];

    const gradeWeights = {
      "4C": 5, "5A": 5, "5B": 5, "5C": 5,
      "6A": 4, "6B": 4, "6C": 3,
      "7A": 2, "7B": 2, "7C": 1,
      "8A": 1
    };

    // Numeric mapping for averaging
    const gradeToNumber = Object.fromEntries(
      grades.map((g, i) => [g, i])
    );

    const minGradeSelect = document.getElementById("minGrade");
    const maxGradeSelect = document.getElementById("maxGrade");
    const historyList = document.getElementById("history");
    const averageEl = document.getElementById("average");

    grades.forEach(g => {
      minGradeSelect.add(new Option(g, g));
      maxGradeSelect.add(new Option(g, g));
    });

    minGradeSelect.value = "5A";
    maxGradeSelect.value = "6B";

    let history = JSON.parse(localStorage.getItem("boulderHistory")) || [];

    function renderHistory() {
      historyList.innerHTML = "";
      history.forEach(g => {
        const li = document.createElement("li");
        li.className = "list-group-item";
        li.textContent = g;
        historyList.appendChild(li);
      });
      renderAverage();
    }

    function renderAverage() {
      if (!history.length) {
        averageEl.textContent = "";
        return;
      }

      const sum = history.reduce((acc, g) => acc + gradeToNumber[g], 0);
      const avgIndex = Math.round(sum / history.length);

      averageEl.textContent = `Average grade: ${grades[avgIndex]}`;
    }

    function saveHistory() {
      localStorage.setItem("boulderHistory", JSON.stringify(history));
    }

    function generate() {
      const min = grades.indexOf(minGradeSelect.value);
      const max = grades.indexOf(maxGradeSelect.value);

      if (min === -1 || max === -1 || min > max) {
        alert("Invalid grade range.");
        return;
      }

      const pool = [];
      for (let i = min; i <= max; i++) {
        pool.push(...Array(gradeWeights[grades[i]]).fill(grades[i]));
      }

      const selected = pool[Math.floor(Math.random() * pool.length)];
      document.getElementById("result").textContent = `You climb: ${selected}`;

      history.unshift(selected);
      saveHistory();
      renderHistory();
    }
    function clearHistory() {
      if (!confirm("Clear all history?")) return;

      history = [];
      localStorage.removeItem("boulderHistory");
      renderHistory();
    }

    renderHistory();
  </script>



  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
